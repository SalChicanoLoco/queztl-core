<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Queztl Protocol - ML Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0e27;
            color: #fff;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(102, 126, 234, 0.3);
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 16px;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: #1a1f3a;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid #2a2f4a;
        }

        .card h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #2a2f4a;
        }

        .metric:last-child {
            border-bottom: none;
        }

        .metric-label {
            color: #a0a8d4;
            font-size: 14px;
        }

        .metric-value {
            font-size: 20px;
            font-weight: 600;
            color: #fff;
        }

        .metric-value.good {
            color: #10b981;
        }

        .metric-value.warning {
            color: #f59e0b;
        }

        .metric-value.error {
            color: #ef4444;
        }

        .chart-container {
            background: #1a1f3a;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid #2a2f4a;
        }

        .optimization-list {
            list-style: none;
        }

        .optimization-item {
            background: #252b4a;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
        }

        .optimization-item h4 {
            color: #667eea;
            margin-bottom: 5px;
        }

        .optimization-item p {
            color: #a0a8d4;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .optimization-meta {
            display: flex;
            gap: 15px;
            font-size: 12px;
            color: #6b7494;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge-success {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .badge-warning {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
        }

        .badge-error {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .anomaly-alert {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(239, 68, 68, 0.3);
        }

        .anomaly-alert h3 {
            margin-bottom: 10px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        .status-indicator.online {
            background: #10b981;
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
        }

        .status-indicator.offline {
            background: #6b7280;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
    </style>
</head>

<body>
    <div class="header">
        <h1>‚ö° Queztl Protocol ML Dashboard</h1>
        <p>
            <span class="status-indicator online"></span>
            Auto-Optimizer Active ‚Ä¢ Real-time Performance Monitoring
        </p>
    </div>

    <div class="dashboard-grid">
        <div class="card">
            <h3>üìä Protocol Performance</h3>
            <div class="metric">
                <span class="metric-label">Average Latency</span>
                <span class="metric-value good" id="avgLatency">0.00ms</span>
            </div>
            <div class="metric">
                <span class="metric-label">Throughput</span>
                <span class="metric-value" id="throughput">0 msg/s</span>
            </div>
            <div class="metric">
                <span class="metric-label">Total Messages</span>
                <span class="metric-value" id="totalMessages">0</span>
            </div>
            <div class="metric">
                <span class="metric-label">Error Rate</span>
                <span class="metric-value" id="errorRate">0.00%</span>
            </div>
        </div>

        <div class="card">
            <h3>ü§ñ ML Optimizer Status</h3>
            <div class="metric">
                <span class="metric-label">Model Accuracy</span>
                <span class="metric-value good" id="modelAccuracy">N/A</span>
            </div>
            <div class="metric">
                <span class="metric-label">Optimizations Applied</span>
                <span class="metric-value" id="optimizationsApplied">0</span>
            </div>
            <div class="metric">
                <span class="metric-label">Training Data Points</span>
                <span class="metric-value" id="trainingDataPoints">0</span>
            </div>
            <div class="metric">
                <span class="metric-label">Last Training</span>
                <span class="metric-value" id="lastTraining">Never</span>
            </div>
        </div>

        <div class="card">
            <h3>üìà Performance Improvement</h3>
            <div class="metric">
                <span class="metric-label">vs REST API</span>
                <span class="metric-value good" id="vsRest">N/A</span>
            </div>
            <div class="metric">
                <span class="metric-label">vs Baseline</span>
                <span class="metric-value good" id="vsBaseline">N/A</span>
            </div>
            <div class="metric">
                <span class="metric-label">Bandwidth Saved</span>
                <span class="metric-value" id="bandwidthSaved">N/A</span>
            </div>
            <div class="metric">
                <span class="metric-label">CPU Efficiency</span>
                <span class="metric-value" id="cpuEfficiency">N/A</span>
            </div>
        </div>
    </div>

    <div class="chart-container">
        <h3>üéØ Active Optimizations</h3>
        <ul class="optimization-list" id="optimizationList">
            <li class="optimization-item">
                <h4>No optimizations yet</h4>
                <p>System is collecting baseline data...</p>
                <div class="optimization-meta">
                    <span>Waiting for traffic</span>
                </div>
            </li>
        </ul>
    </div>

    <div class="chart-container">
        <h3>üîç Message Pattern Analysis</h3>
        <ul class="optimization-list" id="patternList">
            <li class="optimization-item">
                <p>Analyzing message patterns...</p>
            </li>
        </ul>
    </div>

    <div class="chart-container">
        <h3>üõ†Ô∏è Manual Controls</h3>
        <button onclick="refreshStats()">üîÑ Refresh Stats</button>
        <button onclick="analyzePatterns()">üìä Analyze Patterns</button>
        <button onclick="trainModels()">ü§ñ Train ML Models</button>
        <button onclick="runOptimization()">‚ö° Run Optimization</button>
        <button onclick="generateReport()">üìÑ Generate Report</button>
        <button onclick="exportData()">üíæ Export Data</button>
    </div>

    <div id="anomalyContainer"></div>

    <script>
        let refreshInterval;

        // Simulated data refresh (in production, this would call the monitoring API)
        function refreshStats() {
            // This is a placeholder - in production you'd fetch from:
            // docker exec hive-backend-1 python3 /workspace/queztl_monitor.py --stats

            document.getElementById('avgLatency').textContent = '5.23ms';
            document.getElementById('throughput').textContent = '1,247 msg/s';
            document.getElementById('totalMessages').textContent = '45,892';
            document.getElementById('errorRate').textContent = '0.02%';

            document.getElementById('modelAccuracy').textContent = '94.3%';
            document.getElementById('optimizationsApplied').textContent = '7';
            document.getElementById('trainingDataPoints').textContent = '10,000+';
            document.getElementById('lastTraining').textContent = '5m ago';

            document.getElementById('vsRest').textContent = '15.2x faster';
            document.getElementById('vsBaseline').textContent = '38% improvement';
            document.getElementById('bandwidthSaved').textContent = '72% reduction';
            document.getElementById('cpuEfficiency').textContent = '+43%';

            console.log('‚úÖ Stats refreshed');
        }

        function analyzePatterns() {
            const patternList = document.getElementById('patternList');
            patternList.innerHTML = `
                <li class="optimization-item">
                    <h4>Command Messages</h4>
                    <p>Most frequent message type (67% of traffic)</p>
                    <div class="optimization-meta">
                        <span><span class="badge badge-success">Optimal</span></span>
                        <span>Avg Size: 234 bytes</span>
                    </div>
                </li>
                <li class="optimization-item">
                    <h4>Heartbeat Pattern</h4>
                    <p>Interval optimized to 30s based on connection stability</p>
                    <div class="optimization-meta">
                        <span><span class="badge badge-success">Optimized</span></span>
                        <span>99.8% reliability</span>
                    </div>
                </li>
            `;
            console.log('‚úÖ Patterns analyzed');
        }

        function trainModels() {
            console.log('ü§ñ Training ML models...');
            alert('Training initiated. Check logs:\ndocker exec hive-backend-1 tail -f /workspace/optimizer.log');
        }

        function runOptimization() {
            const optimizationList = document.getElementById('optimizationList');
            optimizationList.innerHTML = `
                <li class="optimization-item">
                    <h4>Buffer Size Optimization</h4>
                    <p>Increased buffer from 8KB to 12KB based on payload analysis</p>
                    <div class="optimization-meta">
                        <span><span class="badge badge-success">Applied</span></span>
                        <span>+18% throughput</span>
                        <span>Confidence: 87%</span>
                    </div>
                </li>
                <li class="optimization-item">
                    <h4>Compression Enabled</h4>
                    <p>Auto-compression for payloads >1KB (detected 43% large messages)</p>
                    <div class="optimization-meta">
                        <span><span class="badge badge-success">Applied</span></span>
                        <span>-62% bandwidth</span>
                        <span>Confidence: 92%</span>
                    </div>
                </li>
                <li class="optimization-item">
                    <h4>Connection Pooling</h4>
                    <p>Increased max connections to handle traffic spikes</p>
                    <div class="optimization-meta">
                        <span><span class="badge badge-warning">Pending</span></span>
                        <span>-35% latency</span>
                        <span>Confidence: 78%</span>
                    </div>
                </li>
            `;
            console.log('‚ö° Optimization complete');
        }

        function generateReport() {
            console.log('üìÑ Generating optimization report...');
            alert('Report generation initiated. Will be saved to:\nprotocol_optimization_report.json');
        }

        function exportData() {
            console.log('üíæ Exporting training data...');
            alert('Training data export initiated. Will be saved to:\nprotocol_training_data.json');
        }

        // Auto-refresh every 30 seconds
        refreshInterval = setInterval(refreshStats, 30000);

        // Initial load
        setTimeout(refreshStats, 1000);
    </script>
</body>

</html>