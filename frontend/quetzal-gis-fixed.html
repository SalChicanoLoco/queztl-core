<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="QUETZAL GIS Pro - Enterprise Geospatial Platform">
    <meta name="keywords" content="GIS, mapping, spatial analysis, geospatial">
    <title>QUETZAL GIS Pro - Enterprise Geospatial Platform</title>

    <!-- Core Libraries with SRI -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css"
        integrity="sha512-wmwKM/vsfWXjkwn2Ys+ohg2g4+HxBi+zAyDE8y+0U6vVzEQQOEEILiim2CstRCGLCl2DkIvIlEp4OkyBC70UIw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"
        integrity="sha512-WXoSL2lrKOSIDHwkvCCl1O1j5s47Ag6HdH+bEQFlcwR7RJmiFvd8Rt20Lhs08Px5eJqone3tunNSp7xAkxlFg=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-heat/0.2.0/leaflet-heat.min.js"
        integrity="sha512-RmWGuzoeaqPnEDfpARv/xw/+vkMdAMN3+0NU0GvqmZN1U2rGZ3xfQ/9aVOWWBvVLXKR7mH+J0VaWGHx2dRPqJg=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.1/MarkerCluster.min.css"
        integrity="sha512-mQknnWBg8AL4W8Ot6f//NlUVoUmFTiUiin6zVCwtIluAQja6sArv2ZoO3tiMIcKLj4MA2ZC6ThSryjVceFQHIg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.1/MarkerCluster.Default.min.css"
        integrity="sha512-5PQ60jpg5h6X5AF0h+C7RcSznUlVLIaIjsqwnygsmxMc5ZYePQTh+ZA99YSecGSaS+DnokNiF4Hl7lj+cR7OxA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.1/leaflet.markercluster.min.js"
        integrity="sha512-nQvWaD21nN5WLyYWc/1ZXcq5UZrxVJ3eqP3LD37e4UpM7r1wp3T1+qHfIE+s8Vs2JV3VYwZr1xyDBGX4kVz8g=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <style>
        :root {
            --primary: #0051ba;
            --secondary: #ee3124;
            --accent: #00a651;
            --dark: #1a1a2e;
            --light: #f5f5f5;
            --border: #d0d0d0;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --text-dark: #333;
            --text-light: #666;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html,
        body {
            width: 100%;
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: var(--light);
            color: var(--text-dark);
            overflow: hidden;
        }

        body {
            display: flex;
            flex-direction: column;
        }

        .app-header {
            background: linear-gradient(90deg, #0051ba 0%, #003f87 100%);
            color: white;
            padding: 12px 20px;
            display: flex;
            gap: 15px;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            z-index: 200;
            flex-wrap: wrap;
            min-height: 50px;
        }

        .app-header h1 {
            font-size: 1.6em;
            font-weight: 600;
            margin: 0;
            white-space: nowrap;
        }

        .ribbon-group {
            display: flex;
            gap: 8px;
            align-items: center;
            padding: 0 12px;
            border-right: 1px solid rgba(255, 255, 255, 0.3);
        }

        .ribbon-group:last-child {
            border-right: none;
        }

        .ribbon-btn {
            padding: 8px 14px;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 500;
            transition: all 0.2s ease;
            white-space: nowrap;
            -webkit-user-select: none;
            user-select: none;
        }

        .ribbon-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .app-container {
            display: flex;
            flex: 1;
            overflow: hidden;
            gap: 1px;
            background: var(--border);
        }

        .sidebar {
            width: 280px;
            background: white;
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        .sidebar-section {
            margin-bottom: 20px;
        }

        .sidebar-section h3 {
            font-size: 0.9em;
            color: var(--primary);
            margin-bottom: 10px;
            font-weight: 600;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 8px;
        }

        .sidebar-item {
            padding: 10px 12px;
            background: var(--light);
            border: 1px solid var(--border);
            border-radius: 4px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9em;
            -webkit-user-select: none;
            user-select: none;
        }

        .sidebar-item:hover {
            background: #e3f2fd;
            border-color: var(--primary);
            color: var(--primary);
        }

        #map {
            flex: 1;
            position: relative;
            background: #e0e0e0;
        }

        .right-sidebar {
            width: 250px;
            background: white;
            border-left: 1px solid var(--border);
            overflow-y: auto;
            padding: 15px;
        }

        .property-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .property-section h4 {
            font-size: 0.9em;
            color: var(--primary);
            margin-bottom: 10px;
            font-weight: 600;
        }

        .property-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            font-size: 0.85em;
        }

        .property-label {
            color: var(--text-light);
            font-weight: 500;
        }

        .property-value {
            color: var(--primary);
            font-weight: 600;
            font-family: 'Courier New', monospace;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 8px;
            padding: 30px;
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .modal-content h2 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            font-size: 0.85em;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 5px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 0.85em;
        }

        .btn {
            padding: 10px 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            transition: all 0.2s ease;
            width: 100%;
            margin-bottom: 10px;
            -webkit-user-select: none;
            user-select: none;
        }

        .btn:hover {
            background: #003f87;
        }

        .btn-secondary {
            background: var(--secondary);
        }

        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
            background: #d4edda;
            color: #155724;
        }

        .drawing-mode {
            background: var(--warning);
            color: #333;
            padding: 10px 15px;
            border-radius: 4px;
            margin-bottom: 10px;
            font-weight: 600;
            text-align: center;
        }

        .leaflet-container {
            font-family: inherit;
        }

        .hidden {
            display: none;
        }

        .results-text {
            font-size: 0.85em;
            color: var(--text-light);
            min-height: 60px;
        }

        .results-section {
            margin-top: 15px;
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 3px;
        }
    </style>
</head>

<body>
    <div class="app-header">
        <h1>üó∫Ô∏è QUETZAL GIS Pro</h1>
        <div class="ribbon-group">
            <button class="ribbon-btn" onclick="startDrawing('point')">üìç Point</button>
            <button class="ribbon-btn" onclick="startDrawing('line')">üìè Line</button>
            <button class="ribbon-btn" onclick="startDrawing('polygon')">üî∫ Polygon</button>
            <button class="ribbon-btn" onclick="startDrawing('circle')">‚≠ï Circle</button>
        </div>
        <div class="ribbon-group">
            <button class="ribbon-btn" onclick="openModal('buffer')">üì¶ Buffer</button>
            <button class="ribbon-btn" onclick="openModal('intersect')">üîÄ Intersect</button>
            <button class="ribbon-btn" onclick="openModal('union')">üîó Union</button>
        </div>
        <div class="ribbon-group">
            <button class="ribbon-btn" onclick="openModal('geocode')">üìå Geocode</button>
            <button class="ribbon-btn" onclick="openModal('route')">üõ£Ô∏è Route</button>
            <button class="ribbon-btn" onclick="openModal('settings')">‚öôÔ∏è Settings</button>
        </div>
    </div>

    <div class="app-container">
        <div class="sidebar">
            <div class="sidebar-content">
                <div id="drawingStatus" class="drawing-mode hidden">
                    Click on map to draw
                </div>

                <div class="sidebar-section">
                    <h3>Drawing Tools</h3>
                    <div class="sidebar-item" onclick="startDrawing('point')">üìç Point</div>
                    <div class="sidebar-item" onclick="startDrawing('line')">üìè Line</div>
                    <div class="sidebar-item" onclick="startDrawing('polygon')">üî∫ Polygon</div>
                    <div class="sidebar-item" onclick="startDrawing('circle')">‚≠ï Circle</div>
                    <div class="sidebar-item" onclick="cancelDrawing()">‚ùå Cancel</div>
                </div>

                <div class="sidebar-section">
                    <h3>Analysis</h3>
                    <div class="sidebar-item" onclick="openModal('buffer')">üì¶ Buffer</div>
                    <div class="sidebar-item" onclick="openModal('intersect')">üîÄ Intersect</div>
                    <div class="sidebar-item" onclick="openModal('union')">üîó Union</div>
                </div>

                <div class="sidebar-section">
                    <h3>Basemaps</h3>
                    <div class="form-group">
                        <label><input type="radio" name="basemap" value="osm" checked onchange="setBasemap('osm')">
                            OpenStreetMap</label>
                        <label><input type="radio" name="basemap" value="sat" onchange="setBasemap('sat')">
                            Satellite</label>
                        <label><input type="radio" name="basemap" value="dark" onchange="setBasemap('dark')">
                            Dark</label>
                    </div>
                </div>
            </div>
        </div>

        <div id="map"></div>

        <div class="right-sidebar">
            <div class="property-section">
                <h4>Map Info</h4>
                <div class="property-row"><span class="property-label">Zoom:</span><span class="property-value"
                        id="zoomLevel">2</span></div>
                <div class="property-row"><span class="property-label">Lat:</span><span class="property-value"
                        id="latValue">0.0</span></div>
                <div class="property-row"><span class="property-label">Lng:</span><span class="property-value"
                        id="lonValue">0.0</span></div>
            </div>
            <div class="property-section">
                <h4>Features</h4>
                <div class="property-row"><span class="property-label">Total:</span><span class="property-value"
                        id="featureCount">0</span></div>
                <div class="property-row"><span class="property-label">Status:</span><span class="status-badge"
                        id="status">Ready</span></div>
            </div>
            <div class="property-section">
                <h4>Results</h4>
                <div id="resultsPanel" class="results-text">Ready for analysis</div>
            </div>
        </div>
    </div>

    <!-- MODALS -->
    <div id="bufferModal" class="modal">
        <div class="modal-content">
            <h2>üì¶ Buffer</h2>
            <div class="form-group">
                <label>Distance (km)</label>
                <input type="number" id="bufferDist" value="5" min="0.1" step="0.1">
            </div>
            <button class="btn" onclick="executeBuffer()">Create Buffer</button>
            <button class="btn btn-secondary" onclick="closeModal('buffer')">Cancel</button>
        </div>
    </div>

    <div id="intersectModal" class="modal">
        <div class="modal-content">
            <h2>üîÄ Intersect</h2>
            <p>Select 2+ features and click execute</p>
            <button class="btn" onclick="executeIntersect()">Execute</button>
            <button class="btn btn-secondary" onclick="closeModal('intersect')">Cancel</button>
        </div>
    </div>

    <div id="unionModal" class="modal">
        <div class="modal-content">
            <h2>üîó Union</h2>
            <p>Merge selected features</p>
            <button class="btn" onclick="executeUnion()">Execute</button>
            <button class="btn btn-secondary" onclick="closeModal('union')">Cancel</button>
        </div>
    </div>

    <div id="geocodeModal" class="modal">
        <div class="modal-content">
            <h2>üìå Geocoding</h2>
            <div class="form-group">
                <label>Address</label>
                <input type="text" id="geocodeInput" placeholder="Enter location...">
            </div>
            <button class="btn" onclick="executeGeocoding()">Find</button>
            <div id="geocodeResults" class="results-section"></div>
            <button class="btn btn-secondary" onclick="closeModal('geocode')">Close</button>
        </div>
    </div>

    <div id="routeModal" class="modal">
        <div class="modal-content">
            <h2>üõ£Ô∏è Route</h2>
            <p>Draw 2+ points then click execute</p>
            <button class="btn" onclick="executeRoute()">Calculate Route</button>
            <button class="btn btn-secondary" onclick="closeModal('route')">Cancel</button>
        </div>
    </div>

    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <h2>‚öôÔ∏è Settings</h2>
            <div class="form-group">
                <label><input type="checkbox" checked> Show Coordinates</label>
                <label><input type="checkbox" checked> Show Zoom Level</label>
                <label><input type="checkbox"> Dark Mode</label>
            </div>
            <button class="btn" onclick="closeModal('settings')">Close</button>
        </div>
    </div>

    <script>
        // Global state
        let map;
        let drawnItems;
        let currentDrawingMode = null;
        let currentLine = [];
        let basemapLayers = {};
        let currentBasemap = 'osm';

        // Initialize map
        function initMap() {
            // Create map
            map = L.map('map').setView([39, -98], 4);

            // Create feature group
            drawnItems = new L.FeatureGroup();
            map.addLayer(drawnItems);

            // Setup basemaps
            basemapLayers.osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap',
                maxZoom: 19
            }).addTo(map);

            basemapLayers.sat = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: 'Esri'
            });

            basemapLayers.dark = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                attribution: 'CartoDB'
            });

            // Event listeners
            map.on('moveend zoomend', updatePanel);
            map.on('click', handleMapClick);

            updatePanel();
        }

        // Update info panel
        function updatePanel() {
            const center = map.getCenter();
            document.getElementById('zoomLevel').textContent = map.getZoom();
            document.getElementById('latValue').textContent = center.lat.toFixed(4);
            document.getElementById('lonValue').textContent = center.lng.toFixed(4);
            document.getElementById('featureCount').textContent = drawnItems.getLayers().length;
        }

        // Map click handler
        function handleMapClick(e) {
            if (!currentDrawingMode) return;

            const coords = [e.latlng.lat, e.latlng.lng];

            if (currentDrawingMode === 'point') {
                const marker = L.marker([coords[0], coords[1]], {
                    icon: L.icon({
                        iconUrl: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%230051ba"><circle cx="12" cy="12" r="8"/></svg>',
                        iconSize: [24, 24],
                        iconAnchor: [12, 12]
                    })
                }).addTo(drawnItems);
                showResult('Point added');
                cancelDrawing();
            }
            else if (currentDrawingMode === 'line') {
                currentLine.push(coords);

                // Draw point on map
                L.circleMarker([coords[0], coords[1]], {
                    radius: 5,
                    fillColor: '#0051ba',
                    color: '#fff',
                    weight: 2,
                    opacity: 1,
                    fillOpacity: 0.8
                }).addTo(drawnItems);

                if (currentLine.length >= 2) {
                    const lineCoords = currentLine.map(c => [c[0], c[1]]);
                    const polyline = L.polyline(lineCoords, {
                        color: '#0051ba',
                        weight: 3,
                        opacity: 0.8
                    }).addTo(drawnItems);
                }
            }
            else if (currentDrawingMode === 'polygon') {
                currentLine.push(coords);

                L.circleMarker([coords[0], coords[1]], {
                    radius: 5,
                    fillColor: '#00a651',
                    color: '#fff',
                    weight: 2,
                    opacity: 1,
                    fillOpacity: 0.8
                }).addTo(drawnItems);

                if (currentLine.length >= 3) {
                    const polygonCoords = [...currentLine.map(c => [c[0], c[1]]), currentLine[0]];
                    const polygon = L.polygon(polygonCoords, {
                        color: '#00a651',
                        fillColor: '#00a651',
                        fillOpacity: 0.2,
                        weight: 2
                    }).addTo(drawnItems);
                }
            }
            else if (currentDrawingMode === 'circle') {
                const circle = L.circle([coords[0], coords[1]], {
                    radius: 50000, // 50km
                    color: '#ee3124',
                    fillColor: '#ee3124',
                    fillOpacity: 0.2,
                    weight: 2
                }).addTo(drawnItems);
                showResult('Circle added');
                cancelDrawing();
            }

            updatePanel();
        }

        // Start drawing
        function startDrawing(mode) {
            currentDrawingMode = mode;
            currentLine = [];
            document.getElementById('drawingStatus').style.display = 'block';
            document.getElementById('drawingStatus').textContent = `Drawing: ${mode} - Click on map`;
            showResult(`${mode.toUpperCase()} mode active`);
        }

        // Cancel drawing
        function cancelDrawing() {
            currentDrawingMode = null;
            currentLine = [];
            document.getElementById('drawingStatus').style.display = 'none';
            showResult('Drawing cancelled');
        }

        // Buffer analysis
        function executeBuffer() {
            const dist = parseFloat(document.getElementById('bufferDist').value);
            const layers = drawnItems.getLayers();

            if (layers.length === 0) {
                alert('No features to buffer');
                return;
            }

            let bufferedCount = 0;
            layers.forEach(layer => {
                try {
                    const geo = layer.toGeoJSON();
                    const buffered = turf.buffer(geo, dist, { units: 'kilometers' });

                    L.geoJSON(buffered, {
                        style: {
                            color: '#ff7f0e',
                            weight: 2,
                            opacity: 0.5,
                            fillOpacity: 0.15
                        }
                    }).addTo(drawnItems);
                    bufferedCount++;
                } catch (e) {
                    console.warn('Buffer error:', e);
                }
            });

            showResult(`‚úÖ Created ${bufferedCount} buffer(s) - ${dist}km`);
            closeModal('buffer');
            updatePanel();
        }

        // Intersect analysis
        function executeIntersect() {
            const layers = drawnItems.getLayers();
            if (layers.length < 2) {
                alert('Need at least 2 features');
                return;
            }

            try {
                const geo1 = layers[0].toGeoJSON();
                const geo2 = layers[1].toGeoJSON();
                const intersection = turf.intersect(geo1, geo2);

                if (intersection) {
                    L.geoJSON(intersection, {
                        style: {
                            color: '#00cc99',
                            weight: 3,
                            fillColor: '#00cc99',
                            fillOpacity: 0.4
                        }
                    }).addTo(drawnItems);
                    showResult('‚úÖ Intersection found');
                } else {
                    showResult('‚ö†Ô∏è Features do not intersect');
                }
            } catch (e) {
                alert('Error: ' + e.message);
            }
            closeModal('intersect');
            updatePanel();
        }

        // Union analysis
        function executeUnion() {
            const layers = drawnItems.getLayers();
            if (layers.length < 2) {
                alert('Need at least 2 features');
                return;
            }

            try {
                const geo1 = layers[0].toGeoJSON();
                const geo2 = layers[1].toGeoJSON();
                const union = turf.union(geo1, geo2);

                L.geoJSON(union, {
                    style: {
                        color: '#6b5b95',
                        weight: 2,
                        fillColor: '#6b5b95',
                        fillOpacity: 0.3
                    }
                }).addTo(drawnItems);
                showResult('‚úÖ Union created');
            } catch (e) {
                alert('Error: ' + e.message);
            }
            closeModal('union');
            updatePanel();
        }

        // Geocoding
        function executeGeocoding() {
            const query = document.getElementById('geocodeInput').value;
            if (!query) {
                alert('Enter a location');
                return;
            }

            fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&limit=5`)
                .then(r => r.json())
                .then(data => {
                    const html = data.map((place, idx) => `
                        <div onclick="zoomToLocation(${place.lat}, ${place.lon}, '${place.name}')" style="padding: 10px; background: #f0f0f0; margin: 5px 0; cursor: pointer; border-radius: 4px;">
                            <strong>${place.name}</strong><br>
                            <small>${place.lat.toFixed(4)}, ${place.lon.toFixed(4)}</small>
                        </div>
                    `).join('');
                    document.getElementById('geocodeResults').innerHTML = html || '<p>No results found</p>';
                })
                .catch(e => alert('Geocoding error: ' + e));
        }

        // Zoom to location
        function zoomToLocation(lat, lon, name) {
            map.setView([lat, lon], 12);
            L.marker([lat, lon], {
                popup: name
            }).addTo(drawnItems).openPopup();
            updatePanel();
            closeModal('geocode');
        }

        // Routing
        function executeRoute() {
            const layers = drawnItems.getLayers();
            const points = [];

            layers.forEach(layer => {
                if (layer.getLatLng) {
                    const latlng = layer.getLatLng();
                    points.push([latlng.lng, latlng.lat]);
                }
            });

            if (points.length < 2) {
                alert('Need at least 2 points');
                return;
            }

            const coords = points.join(';');
            fetch(`https://router.project-osrm.org/route/v1/driving/${coords}?geometries=geojson`)
                .then(r => r.json())
                .then(data => {
                    if (data.routes.length > 0) {
                        const route = data.routes[0];
                        L.geoJSON(route.geometry, {
                            style: {
                                color: '#ff0000',
                                weight: 4,
                                opacity: 0.7
                            }
                        }).addTo(drawnItems);

                        const distance = (route.distance / 1000).toFixed(2);
                        showResult(`‚úÖ Route: ${distance} km`);
                    }
                    closeModal('route');
                    updatePanel();
                })
                .catch(e => alert('Routing error: ' + e));
        }

        // Set basemap
        function setBasemap(name) {
            Object.keys(basemapLayers).forEach(key => {
                if (map.hasLayer(basemapLayers[key])) {
                    map.removeLayer(basemapLayers[key]);
                }
            });
            map.addLayer(basemapLayers[name]);
            currentBasemap = name;
        }

        // Show result
        function showResult(msg) {
            document.getElementById('resultsPanel').innerHTML = `<span class="status-badge">${msg}</span>`;
        }

        // Modal functions
        function openModal(id) {
            document.getElementById(id + 'Modal').classList.add('active');
        }

        function closeModal(id) {
            document.getElementById(id + 'Modal').classList.remove('active');
        }

        // Close modal on background click
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('active');
            }
        });

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', initMap);
    </script>
</body>

</html>