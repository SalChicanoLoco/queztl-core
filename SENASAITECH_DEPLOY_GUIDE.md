# üöÄ SENASAITECH.COM DEPLOYMENT GUIDE

## Quick Deploy (5 Minutes)

### Prerequisites
- Ubuntu/Debian server with sudo access
- Domain pointing to your server IP
- Port 80/443 open

### Step 1: Set Environment Variables
```bash
export SERVER_IP="YOUR_SERVER_IP"          # e.g., 192.168.1.100
export SUBDOMAIN="api"                     # Will create api.senasaitech.com
export DEPLOY_USER="root"                  # Or your sudo user
export CERTBOT_EMAIL="admin@senasaitech.com"
```

### Step 2: Deploy
```bash
chmod +x deploy-to-senasaitech.sh
./deploy-to-senasaitech.sh
```

That's it! üéâ

## What Gets Installed

1. **Python 3.11 Environment**
   - FastAPI backend with all dependencies
   - ~5 minutes pip install time

2. **Nginx Reverse Proxy**
   - HTTP ‚Üí HTTPS redirect
   - WebSocket support
   - Security headers

3. **SSL Certificate (Let's Encrypt)**
   - Auto-generated by Certbot
   - Auto-renewal enabled
   - 90-day expiration (renews automatically)

4. **Systemd Service**
   - Auto-start on boot
   - Auto-restart on crash
   - 4 Uvicorn workers

5. **Firewall (UFW)**
   - SSH (22), HTTP (80), HTTPS (443)
   - Optional: API direct access (8000)

## Your Endpoints After Deployment

### üåê Public URLs
```
https://api.senasaitech.com/api/health
https://api.senasaitech.com/api/gen3d/capabilities
https://api.senasaitech.com/api/mining/survey-cost?area_km2=10
https://api.senasaitech.com/docs
```

### ‚õèÔ∏è Mining APIs (11 Endpoints)
- **GIS** (2): LiDAR processing, Radar analysis
- **Geophysics** (5): Magnetic, Resistivity, Seismic, Subsurface modeling
- **Mining** (4): MAG survey, Mineral discrimination, Drill targets, Cost analysis

## Management Commands

### Check Status
```bash
# Service status
systemctl status quetzalcore
systemctl status nginx

# View logs
journalctl -u quetzalcore -f

# Check SSL certificate
certbot certificates
```

### Restart Services
```bash
systemctl restart quetzalcore
systemctl restart nginx
```

### Update Code
```bash
cd /opt/quetzalcore
# Copy new backend files
systemctl restart quetzalcore
```

## Troubleshooting

### Backend Won't Start
```bash
# Check logs
journalctl -u quetzalcore -n 100

# Test manually
cd /opt/quetzalcore
sudo -u quetzalcore /opt/quetzalcore/venv/bin/uvicorn backend.main:app
```

### SSL Certificate Failed
```bash
# Try manual certbot
certbot --nginx -d api.senasaitech.com

# Check DNS
dig api.senasaitech.com +short
# Should show your SERVER_IP
```

### Nginx Won't Start
```bash
# Test config
nginx -t

# Check error logs
tail -f /var/log/nginx/error.log
```

## DNS Configuration

Add this A record in your DNS provider:

| Type | Name | Content | TTL |
|------|------|---------|-----|
| A | api | YOUR_SERVER_IP | 300 |

**Example providers:**
- **Cloudflare**: DNS ‚Üí Add record ‚Üí A ‚Üí api ‚Üí YOUR_IP
- **GoDaddy**: My Domains ‚Üí DNS ‚Üí Add ‚Üí A ‚Üí api ‚Üí YOUR_IP
- **Namecheap**: Domain List ‚Üí Manage ‚Üí Advanced DNS ‚Üí Add Record

‚ö†Ô∏è **Disable Cloudflare Proxy initially** to get SSL cert, then you can enable it.

## Performance Tuning

### Increase Workers (for high traffic)
```bash
# Edit service
nano /etc/systemd/system/quetzalcore.service

# Change --workers 4 to --workers 8
ExecStart=/opt/quetzalcore/venv/bin/uvicorn backend.main:app \
    --host 0.0.0.0 --port 8000 \
    --workers 8 \
    --loop uvloop

# Reload
systemctl daemon-reload
systemctl restart quetzalcore
```

### Add Redis Caching
```bash
apt-get install redis-server
systemctl enable redis-server
systemctl start redis-server
```

## Security Best Practices

1. **Change default SSH port**
2. **Use SSH keys, disable password auth**
3. **Keep system updated**: `apt-get update && apt-get upgrade`
4. **Monitor logs**: `fail2ban` for brute force protection
5. **Add API authentication** (coming soon)

## Next Steps

1. ‚úÖ Deploy to production
2. üß™ Test all endpoints: `curl https://api.senasaitech.com/api/gen3d/capabilities`
3. üìä Monitor performance: `htop`, `journalctl -u quetzalcore -f`
4. üîó Deploy RGIS workers for distributed training
5. üìà Add monitoring/alerting (Prometheus/Grafana)

## Cost Estimate

**DigitalOcean Droplet:**
- $12/month (2GB RAM, 1 vCPU) - Good for testing
- $24/month (4GB RAM, 2 vCPU) - Recommended for production
- $48/month (8GB RAM, 4 vCPU) - High traffic

**AWS EC2:**
- t3.small: ~$15/month
- t3.medium: ~$30/month
- t3.large: ~$60/month

**Vultr VPS:**
- Similar pricing to DigitalOcean

**SSL Certificate:** FREE (Let's Encrypt)

## Support

- üìñ API Docs: https://api.senasaitech.com/docs
- üêõ Issues: Check logs with `journalctl -u quetzalcore -f`
- üìß Contact: admin@senasaitech.com

---

**Ready to deploy?**

```bash
export SERVER_IP="YOUR_IP_HERE"
./deploy-to-senasaitech.sh
```

üöÄ **Let's go!**
